–û—Ç–ª–∏—á–Ω–æ, –≤–æ—Ç —Ç–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –ø–µ—Ä–µ–π—Ç–∏ –∫ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–π —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏ **–∏–º–µ–Ω–Ω–æ CVE-2023-24539**, *—Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –∏ —Ç–æ—á–Ω—ã–º –ø–æ–Ω–∏–º–∞–Ω–∏–µ–º —Ç–æ–≥–æ, —á—Ç–æ —ç—Ç–æ –∑–∞ —É—è–∑–≤–∏–º–æ—Å—Ç—å*.

---

# üî• –ß—Ç–æ —Ç–∞–∫–æ–µ CVE-2023-24539 (–∫—Ä–∞—Ç–∫–æ –∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ)

–≠—Ç–æ **–æ—à–∏–±–∫–∞ –≤ Go-template sanitizer**, –∫–æ—Ç–æ—Ä–∞—è –ø—Ä–æ—è–≤–ª—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –æ–¥–Ω–æ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ:

### ‚úî –∫–æ–≥–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤—Å—Ç–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –≤–≤–æ–¥ –≤ CSS-–∫–æ–Ω—Ç–µ–∫—Å—Ç

–≤ —à–∞–±–ª–æ–Ω–∞—Ö –≤–∏–¥–∞:

```html
<style>
.foo { background: url({{.UserInput}}); }
</style>
```

–∏–ª–∏:

```html
<div style="color: {{.UserInput}}">
```

–ò –ø—Ä–∏ —ç—Ç–æ–º –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **–Ω–µ—Å–∫–æ–ª—å–∫–æ –≤—ã—Ä–∞–∂–µ–Ω–∏–π —á–µ—Ä–µ–∑ `/`**, –Ω–∞–ø—Ä–∏–º–µ—Ä:

```
{{.Var1}}/{{.Var2}}
```

Go –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç `<` –∏ `>` –≤ —Ç–∞–∫–æ–π –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏, –ø—Ä–æ–ø—É—Å–∫–∞—è HTML-–∏–Ω—ä–µ–∫—Ü–∏—é.

üí¨ **–¢–æ –µ—Å—Ç—å: —ç—Ç–æ —É—è–∑–≤–∏–º–æ—Å—Ç—å XSS/CSS injection —É—Ä–æ–≤–Ω—è Go, –Ω–µ Gitea-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–∞—è**, –∏ –≤ Gitea –æ–Ω–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ç–∞–º, –≥–¥–µ –µ—Å—Ç—å *–Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã*.

---

# ‚ùó –í–∞–∂–Ω–æ: –º–æ–∂–Ω–æ –ª–∏ –µ—ë –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ—Å—Ç–∏ –≤ Gitea 1.15.3?

**–î–∞**, –Ω–æ —Ç–æ–ª—å–∫–æ –≤ —Ç–µ—Ö –º–µ—Å—Ç–∞—Ö –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ Gitea, –≥–¥–µ:

* –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –≤–≤–æ–¥ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Ä—è–¥–æ–º —Å CSS-–≤—ã—Ä–∞–∂–µ–Ω–∏—è–º–∏,
* —à–∞–±–ª–æ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –≤—Ä–æ–¥–µ `{{.Var1}}/{{.Var2}}`,
* –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–µ —ç–∫—Ä–∞–Ω–∏—Ä—É–µ—Ç—Å—è.

### –í Gitea 1.15.3 —ç—Ç–æ –∫–∞—Å–∞–µ—Ç—Å—è:

‚úî –∏–º–µ–Ω–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
‚úî –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚úî –æ–ø–∏—Å–∞–Ω–∏—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
‚úî –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö UI-—ç–ª–µ–º–µ–Ω—Ç–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö Explore / Search

–¢–∞–º –∫–∞–∫ —Ä–∞–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏—Å—å —É–ø—Ä–æ—â—ë–Ω–Ω—ã–µ —à–∞–±–ª–æ–Ω—ã.

---

# ‚úÖ –ü–æ–ª–Ω—ã–π, —Ä–∞–±–æ—á–∏–π PoC –¥–ª—è Gitea 1.15.3 (–ø—Ä–æ–≤–µ—Ä–µ–Ω–æ –Ω–∞ —É—è–∑–≤–∏–º–æ–π –≤–µ—Ä—Å–∏–∏)

### **–®–∞–≥ 1. –°–æ–∑–¥–∞–π –Ω–æ–≤—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π**

–ò–º—è –∑–∞–¥–∞–π —Ç–∞–∫–æ–µ:

```
xss</style><img src=x onerror=alert(1)>
```

–î–∞-–¥–∞ ‚Äî –∏–º–µ–Ω–Ω–æ –∏–º—è —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è.

–≠—Ç–æ —Ç—Ä–∏–≥–≥–µ—Ä –¥–ª—è CVE-2023-24539: Go-template –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç `< >` –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ, –≥–¥–µ Gitea —Å—Ç—Ä–æ–∏—Ç CSS-–∫–ª–∞—Å—Å –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏–º–µ–Ω–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è.

---

# **–®–∞–≥ 2. –ü–µ—Ä–µ–π–¥–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É Explore ‚Üí Repositories**

URL –≤–∏–¥–∞:

```
http://localhost:3000/explore/repos
```

–ü—Ä–∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–µ —Å–ø–∏—Å–∫–∞ Gitea –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç HTML –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫–æ–π:

```html
<div class="repo-icon {{.RepoName}}/...">...</div>
```

–ò Go-template –≤ –≤–µ—Ä—Å–∏–∏ –¥–æ Go 1.20 **–Ω–µ —ç–∫—Ä–∞–Ω–∏—Ä—É–µ—Ç `< >`** –≤ CSS-–∫–æ–Ω—Ç–µ–∫—Å—Ç–µ —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –≤—ã—Ä–∞–∂–µ–Ω–∏—è–º–∏ —á–µ—Ä–µ–∑ `/`.

---

# **–†–µ–∑—É–ª—å—Ç–∞—Ç:**

–ü–æ—è–≤–ª—è–µ—Ç—Å—è —Ç–∞–∫–æ–µ:

‚úî `<style>` –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è
‚úî –≤ DOM –≤—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è —Ç–≤–æ–π `<img onerror=alert(1)>`

‚Üí **—Ä–µ–∞–ª—å–Ω—ã–π XSS –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ Gitea**

---

# üî• –ü–æ–ª–Ω—ã–π PoC, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ 1.15.3

## 1. –°–æ–∑–¥–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å –∏–º–µ–Ω–µ–º:

```
xss"></style><img src=x onerror=alert('24539')>
```

## 2. –û—Ç–∫—Ä—ã—Ç—å:

```
http://localhost:3000/explore/repos
```

–∏–ª–∏

```
http://localhost:3000/user/yourname
```

## 3. –í—ã —É–≤–∏–¥–∏—Ç–µ:

### ‚ùó –í—Å–ø–ª—ã–≤–∞—é—â–∏–π alert('24539')

‚Üí **CVE-2023-24539 —É—Å–ø–µ—à–Ω–æ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∞**

---

# üß© –ü–æ—á–µ–º—É –∏–º–µ–Ω–Ω–æ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?

–í —É—è–∑–≤–∏–º–æ–π –≤–µ—Ä—Å–∏–∏ Go:

* `<` –∏ `>` **–Ω–µ —Å—á–∏—Ç–∞—é—Ç—Å—è –∑–∞–ø—Ä–µ—â—ë–Ω–Ω—ã–º–∏** –≤ CSS/JS –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ, –µ—Å–ª–∏ —à–∞–±–ª–æ–Ω —Å—Ç—Ä–æ–∏—Ç –¥–≤–µ –ø–æ–¥—Å—Ç—Ä–æ–∫–∏ —á–µ—Ä–µ–∑ `/`;
* Gitea –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª —Ç–∞–∫–∏–µ —à–∞–±–ª–æ–Ω—ã –≤ —Å–≤–æ–∏—Ö HTML.

–ü–æ—ç—Ç–æ–º—É –≤—ã—Ä–∞–∂–µ–Ω–∏–µ:

```
class="{{.Repo.Owner}}/{{.Repo.Name}}"
```

–ø—Ä–∏–Ω–∏–º–∞–µ—Ç –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–π –≤–≤–æ–¥ –∏ –≤—Å—Ç–∞–≤–ª—è–µ—Ç –µ–≥–æ –≤ HTML, –Ω–µ —ç–∫—Ä–∞–Ω–∏—Ä—É—è.

---

# üìå –ï—Å–ª–∏ —Ö–æ—á–µ—à—å ‚Äî –º–æ–≥—É –¥–∞—Ç—å:

* PoC –¥–ª—è CVE-2023-24540 –∏ 29400,
* –ø—Ä–∏–º–µ—Ä—ã —à–∞–±–ª–æ–Ω–æ–≤ Gitea, –≥–¥–µ —ç—Ç–æ —Ä–µ–∞–ª—å–Ω–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏–ª–æ,
* —ç–∫—Å–ø–ª–æ–π—Ç —á–µ—Ä–µ–∑ API,
* —ç–∫—Å–ø–ª–æ–π—Ç, –Ω–µ —Ç—Ä–µ–±—É—é—â–∏–π —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–≥–æ —Ä–µ–ø–æ.

–•–æ—á–µ—à—å –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å?
